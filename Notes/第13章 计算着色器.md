## 第13章 计算着色器
我们将GPU用于非图形应用程序的情况称为通用GPU程序设计  
(通用GPU编程, General Purpose GPU programming, GPGPU programming)  
计算着色器能够使我们访问GPU来实现数据并行算法,而不必渲染出任何图形  
### 13.2 一个简单的计算着色器
一个计算着色器由下列要素构成:  
1. 通过常量缓冲区访问的全局变量  
2. 输入与输出资源
3. [numthreads(X, Y, Z)]属性,指定3D线程网格中的线程数量  
4. 每个线程都要执行的着色器命令  
5. 线程ID系统值参数  
  
为了开启计算着色器,我们还需使用其特定的"计算流水线状态描述",因为计算着色器位列图形流水线之外  
根签名定义了什么参数才是着色器期望的输入(CBV, SRV等),而CS(即compute shader)字段就是所指定的计算着色器  
### 13.3 数据的输入与输出资源
计算着色器处理输出资源的方式比较特殊,它们的类型还有一个特别的前缀"RW",意为读与写  
为了绑定在CS中要执行写操作的资源,我们需要将其与称为无需访问视图(Unordered Access View, UAV)的新型视图关联在一起  
基于分派的线程ID来索引纹理,每个线程都要被指定一个唯一的调度ID(调度标识符)  
mCommandList->CopyResource() 将GPU资源复制到系统内存资源之中  
### 13.4 线程标识的系统值
系统会为每个线程组都分配一个ID,这个ID称为线程组ID(group ID),其系统值的语义为 SV_GroupID  
在线程组中,每个线程都被指定了一个组内的唯一ID,组内线程ID(group thread ID),组内线程ID系统值的语义为 SV_GroupThreadID  
调用一次 Dispatch 函数便会分派一个线程组网格. 调度线程ID(dispatch thread ID,分派线程ID)是Dispatch调用为线程所生成的唯一标识(相对于所有的线程而言).  
调度线程ID的系统值语义为SV_DispatchThreadID  
### 13.6 共享内存与线程同步
每个线程组都有一块称为共享内存(shared memory)或线程本地存储器(thread local storage)的内存空间, 这种内存的访问速度很快  
由于共享内存是线程组里的本地内存,所以要通过 SV_GroupThreadID 语义对它进行索引  
我们可以使用组内的每个线程都来访问共享内存中的同一个元素  
同步命令,等待组内的所有线程都完成各自的任务  
GroupMemoryBarrierWithGroupSync()  
### 13.7 图像模糊演示程序
模糊算法: 针对源图像中的每一个像素Pij,计算以它为中心的m*n矩阵的加权平均值  
高斯模糊:可分离性,将它分为ID横向模糊,再对输出的结果进行ID纵向模糊  
渲染到离屏纹理(render-to-off-screen-texture): 将数据绘制到"离屏(off-screen)"纹理中,而非后台缓冲区之内. 在执行提交操作(present)的过程中,它无法显示在屏幕上  
模糊算法关键步骤:
1. 将场景绘制到离屏纹理之中  
2. 通过CS对该纹理进行模糊处理  
3. 将后台缓冲区恢复为渲染目标,并以模糊后的纹理来绘制全屏四边形  
